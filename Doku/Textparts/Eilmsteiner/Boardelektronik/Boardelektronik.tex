Zusammen mit der für den jeweiligen Einsatzzweck benötigten Peripherie bilden sowohl ein Arduino Nano als auch ein CAN-Bus Modul den Grundstein für die zur Steuerung des Bootes benötigte Elektronik.\\

\begin{minipage}{7cm}
    \includegraphics[width=\textwidth]{Fotos/Arduino_Nano.png}
    \captionof{figure}{Arduino Nano}
\end{minipage}
\begin{minipage}{7cm}
\includegraphics[width=\textwidth]{Fotos/CAN_BUS_Shield.png}
\captionof{figure}{CAN-Bus Modul}
\end{minipage}
\section{Übertragungsmedium CAN-Bus}
\subsection{Gründe für die Verwendung}
Um eine zuverlässige Übertragung der Regelparameter für unsere Motoren sowie Servos garantieren zu können, wurde für deren Übertragung ein aus der Automobilbranche bekanntes Übertragungsmedium verwendet, der CAN-Bus. 
Neben seiner Robustheit trotz relativ hoher Übertragungsgeschwindigkeit, war es vorallem sein dezentraler Aufbau, der ihn für unseren Anwendungszweck optimal gemacht hat.

\newpage

\subsection{Verwendete Adressen}
\begin{table}[h]
    \begin{tabular}{|l|l|l|l|}
        \hline
    Name                              & CAN-ID & Info         & Länge \\\hline
    CONTROL\_MOTORS\_SERVOS  & 0xC0   & Gas-\& Lenkerstellung & 3     \\
    INFOS\_LOWER\_CONTROLLER & 0xC1   & Telemetriedaten Motor unten  & 6     \\
    INFOS\_BACK\_CONTROLLER  & 0xC3   & Telemetriedaten Motor hinten & 6     \\
    BATTERY\_TEMPS           & 0xE0   & Akku-Temperaturen            & 8    \\\hline
    \end{tabular}
    \caption{Verwendete CAN-Bus Adressen}
\end{table}

\section{Die zur Steuerung entworfenen Platinen}
\subsection{Motorregleransteuerung}
\subsubsection{Aufgaben \& verwendete Bauteile}
Diese wandeln die entsprechenden vom CAN-Bus übertragenen Daten mithilfe ihres 16-bit Timers (Timer1 des ATMEGA328p) in ein für unseren Motorregler verständliches PWM-Muster um.
Gleichzeitig übermitteln sie die von den Motorreglern übertragenen Telemetriedaten an den Controller des Lenkers.

\begin{minipage}{8.5cm}
    \begin{tikzpicture}
        \node[anchor=south west,inner sep=0] (image) at (0,0) {\includegraphics[width=0.9\textwidth]{Fotos/Regler_Platine.png}};
        \begin{scope}[x={(image.south east)},y={(image.north west)}]
            \draw[red,ultra thick,rounded corners,rotate around={-23:(0.68,0.68)}] (0.62,0.67) rectangle (0.8,0.9);
            \draw[blue,ultra thick,rounded corners,rotate around={-20:(0.3,0.68)}] (0.2,0.53) rectangle (0.35,0.7);
            \draw[orange,ultra thick,rounded corners,rotate around={-20:(0.35,0.78)}] (0.26,0.66) rectangle (0.41,0.8);
        \end{scope}
    \end{tikzpicture}
    \captionof{figure}{Platine zur Regleransteuerung}
\end{minipage}
\begin{minipage}{7cm}
    \textcolor{red}{CAN-Bus Anschlüsse}\\
    \textcolor{orange}{Serielle Verbindung zum Regler}\\
    \textcolor{blue}{PWM-Ausgang}\\

\end{minipage}

\newpage

\subsubsection{Schaltplan}
\begin{figure}[h]
    \centering
    \includegraphics[width=1.0\textwidth]{../Proteus/Exports/Regler-Platine.png}    
    \caption{Schaltplan der Regler-Platine}
\end{figure}

\newpage
\subsection{Lenker}
\subsubsection{Aufgaben \& verwendete Bauteile}
Neben seiner Hauptaufgabe, nämlich dem Einlesen und der Übertragung der beiden Daumengas- sowie Lenkerstellungen ist dieser Mikrocontroller weiters für die Darstellung der von den verschiedenen Komponenten erhaltenen Telemetriedaten auf dem Bildschirm verantwortlich.
Dazu zählen neben den Informationen über die beiden Motoren vorallem auch die Temperaturen aller verbauten Akkus sowie die per GPS-Modul ermittelte derzeitige Geschwindigkeit.

\begin{minipage}{8.5cm}
    \begin{tikzpicture}
        \node[anchor=south west,inner sep=0] (image) at (0,0) {\includegraphics[width=0.9\textwidth]{Fotos/Regler_Lenker.png}};
        \begin{scope}[x={(image.south east)},y={(image.north west)}]
            \draw[red,ultra thick,rounded corners,rotate around={-30:(0.77,0.47)}] (0.6,0.47) rectangle (0.77,0.62);
            \draw[blue,ultra thick,rounded corners,rotate around={-30:(0.4,0.58)}] (0.25,0.58) rectangle (0.4,0.68);
            \draw[orange,ultra thick,rounded corners,rotate around={-30:(0.47,0.67)}] (0.33,0.67) rectangle (0.47,0.76);
            \draw[green,ultra thick,rounded corners,rotate around={-34:(0.57,0.67)}] (0.45,0.67) rectangle (0.57,0.8);
            \draw[yellow,ultra thick,rounded corners,rotate around={-34:(0.62,0.60)}] (0.54,0.60) rectangle (0.62,0.75);
        \end{scope}
    \end{tikzpicture}
    \captionof{figure}{Platine des Lenkers}
\end{minipage}
\begin{minipage}{7cm}
    \textcolor{red}{CAN-Bus Anschlüsse}\\
    \textcolor{blue}{Serielle Verbindung zum GPS-Modul}\\
    \textcolor{orange}{Serielle Verbindung zum Bildschirm}\\
    \textcolor{green}{Daumengas Anschlüsse}\\
    \textcolor{yellow}{Anschluss Lenkerpotenziometer}\\
    
\end{minipage}

\begin{figure}[h]
    \centering
    \includegraphics[width=0.5\textwidth]{Fotos/GPS_Modul.png}
    \caption{verwendetes GPS-Modul}
\end{figure}

\newpage
\subsubsection{Schaltplan}
\begin{figure}[h]
    \centering
    \includegraphics[width=1.0\textwidth]{../Proteus/Exports/Lenker-Platine.png}    
    \caption{Schaltplan der Lenker-Platine}
\end{figure}

\newpage

\subsection{Fahnenansteuerung und Akkutemperaturen}
\subsubsection{Fahnenansteuerung}
Auch die Ansteuerung der Servos erfolgte mit einem per CAN-Bus angeschlossenen Arduino. Um die für die Steuerung der drei Servos benötigten PWM-Signale unabhängig von den durch den Arduino bereitgestellten Timer und den damit verbunden GPIOs zu erzeugen 
(Anbindung des CAN-Bus Moduls über SPI benötigt beispielsweise diese Pins und Timer), wurde dafür auf ein externes Board zurückgegriffen.

\begin{minipage}{8.5cm}
    \begin{tikzpicture}
        \node[anchor=south west,inner sep=0] (image) at (0,0) {\includegraphics[width=0.9\textwidth]{Fotos/Regler_Servos.png}};
        \begin{scope}[x={(image.south east)},y={(image.north west)}]
            \draw[red,ultra thick,rounded corners,rotate around={-23:(0.64,0.68)}] (0.58,0.67) rectangle (0.78,0.9);
            \draw[blue,ultra thick,rounded corners,rotate around={-20:(0.5,0.9)}] (0.37,0.76) rectangle (0.63,0.99);
        \end{scope}
    \end{tikzpicture}
    \captionof{figure}{Platine zur Regleransteuerung}
\end{minipage}
\begin{minipage}{7cm}
    \textcolor{red}{CAN-Bus Anschlüsse}\\
    \textcolor{blue}{I2C Anschlüsse}\\
    
\end{minipage}\\

Konkret handelt es sich um das \textbf{16-Channel 12-bit PWM/Servo Driver Module} von Adafruit, welcher mittels I2C mit dem Mikrocontroller kommuniziert.\\
\begin{figure}[h]
    \centering
    \includegraphics[width=0.5\textwidth]{Fotos/Servo_Controller.png}
    \caption{Adafruit 16-Channel Servo Driver}
\end{figure}

\newpage
\subsubsection{Schaltplan}
\begin{figure}[h]
    \centering
    \includegraphics[width=1.0\textwidth]{../Proteus/Exports/Servos-Platine.png}    
    \caption{Schaltplan der Servoansteuerung-Platine}
\end{figure}


\newpage
\subsubsection{Akkutemperaturen}
Die zweite Aufgabe dieses Controllers ist es, die Temperaturen aller acht im Boot verbauten Akkus zu überwachen, und diese zur Darstellung an den Controller des Lenkers zu übermitteln.
Dies geschieht mithilfe zweier (je einer pro Seite verbauten) ebenfalls über I2C verbundenen \textbf{ADS1115} Analog-Digital-Wandler, welche wiederum von Adafruit stammen.\\
Zur Temperaturmessung selbst kommt je ein \textbf{LM35} Temperatursensor pro Akku zum Einsatz.\\

\begin{minipage}{8cm}
    \centering
    \includegraphics[width=0.85\textwidth]{Fotos/ADS1115_2.png}
    \captionof{figure}{ADS1115 Modul}    
\end{minipage}
\begin{minipage}{8cm}
    \centering
    \includegraphics[width=0.17\textwidth]{Fotos/LM35.png}
    \captionof{figure}{LM35}
\end{minipage}\\
\vspace{0.5cm}

Um den Anschluss der Temperatursensoren an diesem ADC zu vereinfachen, wurde folgende Platine entworfen:\\ 
\begin{minipage}{9cm}
    \begin{tikzpicture}
        \node[anchor=south west,inner sep=0] (image) at (0,0) {\includegraphics[width=0.9\textwidth]{Fotos/ADC_Platine.png}};
        \begin{scope}[x={(image.south east)},y={(image.north west)}]
            \draw[red,ultra thick,rounded corners,rotate around={-23:(0.78,0.0)}] (0.25,0.0) rectangle (0.78,0.4);
            \draw[blue,ultra thick,rounded corners,,rotate around={-30:(0.00,0.59)}] (0.00,0.59) rectangle (0.20,0.99);
            \draw[orange,ultra thick,rounded corners,,rotate around={-27:(0.3,0.4)}] (0.15,0.4) rectangle (0.34,0.57);
        \end{scope}
    \end{tikzpicture}
    \captionof{figure}{Platine Temperatursensoren}
\end{minipage}
\begin{minipage}{7cm}
    \textcolor{red}{Analogeingänge}\\
    \textcolor{blue}{I2C Anschluss}\\
    \textcolor{orange}{I2C Adressen-Jumper}\\
\end{minipage}\\

\newpage
\subsubsection{Schaltplan}
\begin{figure}[h]
    \centering
    \includegraphics[width=0.65\textwidth]{../Proteus/Exports/Temperatursensoren-Platine.png}    
    \caption{Schaltplan der Temperatursensoren-Platine}
\end{figure}

\newpage
\section{Precharge \& Relaisansteuerung}
Da sowohl die Motorregler als auch die Buck-Converter einen, durch die darin verbauten sehr großen Kondensatoren bedingten, sehr großen Einschaltstrom haben, 
müssen diese über einen Leistungswiderstand vorgeladen werden, bevor sie permanent mit Spannung versorgt werden können.\\
\begin{figure}[h]
    \centering
    \includegraphics[width=0.55\textwidth]{Fotos/Leistungswiderstand.png}
    \caption{Zur Vorladung verwendeter Leistungswiderstand}
\end{figure}

Um diese Umschaltung so einfach wie möglich zu gestalten, wurde dies mithilfe einer im folgenden genauer erläuterten Platine realisiert. 

\begin{minipage}{9cm}
    \begin{tikzpicture}
        \node[anchor=south west,inner sep=0] (image) at (0,0) {\includegraphics[width=0.9\textwidth]{Fotos/Platine_Relaischaltung.png}};
        \begin{scope}[x={(image.south east)},y={(image.north west)}]
            \draw[red,ultra thick,rounded corners,rotate around={-23:(0.78,0.0)}] (0.25,0.0) rectangle (0.78,0.4);
            \draw[blue,ultra thick,rounded corners,,rotate around={-30:(0.00,0.59)}] (0.00,0.59) rectangle (0.20,0.99);
            \draw[orange,ultra thick,rounded corners,,rotate around={-27:(0.3,0.4)}] (0.15,0.4) rectangle (0.34,0.57);
        \end{scope}
    \end{tikzpicture}
    \captionof{figure}{Platine zur Relaisansteuerung}
\end{minipage}
\begin{minipage}{7cm}
    \textcolor{red}{Analogeingänge}\\
    \textcolor{blue}{I2C Anschluss}\\
    \textcolor{orange}{I2C Adressen-Jumper}\\
\end{minipage}\\


\newpage
\section{Bildschirm}
\begin{figure}[h]
    \includegraphics[width=0.8\textwidth]{Fotos/Nextion_Display.png}
    \caption{Nextion-Display}
\end{figure}
Bei dem verwendeten Bildschirm handelt es sich um einen 5 Zoll großen Touchscreen aus dem Hause Nextion.
Diese bieten den großen Vorteil, die graphische Darstellung bequem über das verfügbare gratis Tool (\textbf{Nextion Editor}) designen zu können, während der Arduino den Bildschirm nur mit den nötigen Daten über eine Serielle Verbindung versorgen muss. 

